<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElevenLabs Text-to-Speech</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            padding: 10px;
        }
        select, input, button {
            margin: 10px 0;
            padding: 10px;
        }
        .settings-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .settings-container > div {
            width: 48%;
        }
        #audio-player {
            margin-top: 20px;
        }
        #voices-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .voice-option {
            border: 2px solid #ddd;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .voice-option.selected {
            border-color: #007bff;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>ElevenLabs Text-to-Speech Converter</h1>
    
    <textarea id="text-input" placeholder="Enter text to be spoken..."></textarea>
    
    <div id="voices-container">
        <!-- Voice options will be dynamically populated -->
    </div>

    <div class="settings-container">
        <div>
            <label>Stability:</label>
            <input type="range" id="stability-input" min="0" max="1" step="0.1" value="0.5">
            <span id="stability-value">0.5</span>
        </div>
        <div>
            <label>Similarity Boost:</label>
            <input type="range" id="similarity-input" min="0" max="1" step="0.1" value="0.5">
            <span id="similarity-value">0.5</span>
        </div>
    </div>
    
    <div>
        <button id="convert-btn">Convert to Speech</button>
    </div>

    <audio id="audio-player" controls style="display:none;"></audio>

    <div id="status-message"></div>

    <script>
        const textInput = document.getElementById('text-input');
        const voicesContainer = document.getElementById('voices-container');
        const convertBtn = document.getElementById('convert-btn');
        const audioPlayer = document.getElementById('audio-player');
        const statusMessage = document.getElementById('status-message');
        const stabilityInput = document.getElementById('stability-input');
        const similarityInput = document.getElementById('similarity-input');
        const stabilityValue = document.getElementById('stability-value');
        const similarityValue = document.getElementById('similarity-value');

        let selectedVoiceId = null;

        // Update slider values
        stabilityInput.addEventListener('input', () => {
            stabilityValue.textContent = stabilityInput.value;
        });

        similarityInput.addEventListener('input', () => {
            similarityValue.textContent = similarityInput.value;
        });

        // Fetch available voices
        async function fetchVoices() {
            try {
                const response = await fetch('tts.php?action=voices', {
                    method: 'GET',
                    headers: {
                        'xi-api-key': 'sk_3b866cffe674c37dbd21e0be192e6bb84ba351f94da3ce36'
                    }
                });
                const voices = await response.json();
                
                // Populate voices
                voicesContainer.innerHTML = '';
                voices.voices.forEach(voice => {
                    const voiceElement = document.createElement('div');
                    voiceElement.classList.add('voice-option');
                    voiceElement.textContent = `${voice.name} (${voice.description || 'No description'})`;
                    voiceElement.dataset.voiceId = voice.voice_id;
                    
                    voiceElement.addEventListener('click', () => {
                        // Deselect all voices
                        document.querySelectorAll('.voice-option').forEach(el => {
                            el.classList.remove('selected');
                        });
                        
                        // Select clicked voice
                        voiceElement.classList.add('selected');
                        selectedVoiceId = voice.voice_id;
                    });
                    
                    voicesContainer.appendChild(voiceElement);
                });
            } catch (error) {
                statusMessage.textContent = `Error fetching voices: ${error.message}`;
                console.error('Voice fetch error:', error);
            }
        }

        // Initial voice fetch
        fetchVoices();

        convertBtn.addEventListener('click', async () => {
            // Reset previous state
            statusMessage.textContent = '';
            audioPlayer.style.display = 'none';
            audioPlayer.src = '';

            // Validate input
            const text = textInput.value.trim();
            if (!text) {
                statusMessage.textContent = 'Please enter some text';
                return;
            }

            // Validate voice selection
            if (!selectedVoiceId) {
                statusMessage.textContent = 'Please select a voice';
                return;
            }

            try {
                // Show loading message
                statusMessage.textContent = 'Converting text to speech...';

                // Prepare request payload
                const payload = {
                    text: text,
                    voiceId: selectedVoiceId,
                    settings: {
                        stability: parseFloat(stabilityInput.value),
                        similarity_boost: parseFloat(similarityInput.value)
                    }
                };

                // Send request to PHP backend
                const response = await fetch('tts.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'xi-api-key': 'YOUR_ELEVENLABS_API_KEY_HERE'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                // Handle response
                if (result.success) {
                    // Update audio player
                    audioPlayer.src = result.audioPath;
                    audioPlayer.style.display = 'block';
                    statusMessage.textContent = 'Conversion successful!';
                } else {
                    throw new Error(result.error || 'Unknown error occurred');
                }
            } catch (error) {
                statusMessage.textContent = `Error: ${error.message}`;
                console.error('Conversion error:', error);
            }
        });
    </script>
</body>
</html>
